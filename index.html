<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>帝王世系</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="scripts/jquery-ui.js"></script>
        <script src="scripts/vivagraph.js"></script>
		<script src="scripts/main.js"></script>
		<!-- script src="scripts/utils.js"></script -->
        
        <script type='text/javascript'>

        
            $(function() {
                dataReady = true
                jHist.init_display('graphContainer')

                				
				fetch_json()
				
				initui()
				addEventHandlers()

            })
			
			function  initui(){
				$(".tab, .left-tab, .right-tab").css('zIndex', '10000')
			}
			
			function addEventHandlers() {
				
				
				// window resize event handler
                $( window ).resize(function() { onWindowResize() });
				document.body.addEventListener('keydown', function (e) {
					if (e.which === 32) { // spacebar
						if (jHist.isrunning()){
							jHist.pause()
						} else {
							jHist.resume()
						}
					}
				 })

				$('.tab').mousedown(function(e){
					var id = $(this).prop('id')
					console.log(id)
					if (id == 'help-tab'){
						$(this).css('zIndex', '10000').hide("slide", { direction: "left" }, 500);
						$('#usage').css('zIndex', '10000').show("slide", { direction: "left" }, 500);
					} 
				})
				
				$('.dismiss').click(function(e){
					var id = $(this).prop('id')
					if (id == 'dismiss-usage'){
						$('#usage').css('zIndex', '10000').hide("slide", { direction: "left" }, 500);
						$('#help-tab').css('zIndex', '10000').show("slide", { direction: "left" }, 500);
					} 
				})
			}
			
			function fetch_json() {
				console.log('fetch file...')
				var file = '/data/shang_gu.json'
				$.ajax({
					dataType: "json",
					async: true,
					url: file,
					success: function(response) {
						jHist.addNodes(response.nodes)
						jHist.addLinks(response.links)
						//console.dir(response)
					},
					error: function(xhr, ajaxOptions, thrownError){
						console.dir('failed to fetch file ' + file)
						console.dir(xhr)
					}
				});
			}
            
			function onWindowResize(){
				if (dataReady) {
					jHist.renderer().reset()
				}
			}

        </script>
        <style type='text/css'>
            body, svg, #graphContainer, #main-pan {
                height: 100%;
                width: 100%;
                position: absolute;
                margin: 0;
            }
			
			.tab, .left-tab, .right-tab {
				position : fixed;
				height : 26px;
				width : 26px;
				top : 10px;
				background-color: #eee;
	
				padding: 4px;
				vertical-align : top;
				opacity: 0.5;
				-moz-border-radius : 6px;
				-webkit-border-radius : 6px;
				-khtml-border-radius : 6px;
				border-radius : 4px;
			}

			.left-tab{
				left : -2px;
			}
	
			.right-tab{
				right : -6px;
			}
	
			.tab:hover {
				background-color: #bbb;
				opacity: 1.0; /* css standard */
			}

			.dismiss, .sub-menu{
				cursor : pointer;
				width  : 14px;
				height : 14px;
			}
			.dismiss-container{
				padding: 6px;
				padding-top: 9px;
				border-radius : 4px;
			}
			.dismiss-container:hover{
				background-color : #bbb;
			}
	
			#usage{
				text-align: left;
				color: #666;
				left: 10px;
				font-size: 12px;
				font-family: Verdana;
				font-weight: bold;
	
				left:0px;
				top:10px;
				width:auto;
				position:fixed;
	
				display:none;
				background-color: #fff;
				padding: 2px;
				opacity: 0.3;
				-moz-border-radius : 6px;
				-webkit-border-radius : 6px;
				-khtml-border-radius : 6px;
				border-radius : 6px;
				border-radius : 6px;
	
			}

			#usage:hover, #config:hover, #dismiss-usage:hover {
				opacity: 1;
			}

        </style>
    </head>
    <body oncontextmenu="return false;">
		<img id="help-tab" class="tab left-tab" src="/images/info20x20.png" title="help info"> </img>
		<span id="usage">
			<span class="dismiss-container"><img id="dismiss-usage" class="dismiss" src="/images/arrow_left20x20.png" title="hide help info"></img></span>
			<ul class="">
				<li>
					Use mouse wheel to zoom in/out, and left button down to translate.
				</li>
				<li>
					Use spacebar to stop/resume rendering.
				</li>
			</ul>
		</span>
				
		<div id="graphContainer" style="background-color: #fff; "></div>

    </body>
</html>
